# Проектная работа по модулю “DWH”

## fw_dwh-27_script.sql

SQL-cкрипт выполнняется в БД, к которой осуществляется подключение в рамках ETL-процедур.
При выполнении скрипта: 
* Производится последовательное удаление (если существуют) и создание следующих сущностей:
  * Table:
    *  fact_flights - таблица фактов по совершенным перелётам;
    *  reject_fact_flights - таблица отбраковки для некачественных строк, загружаемых в fact_flights;
    *  dim_calendar - справочник дат с 01-01-2016 по 01-01-2030;
    *  dim_passengers - справочник пассажиров;
    *  reject_dim_passengers - таблица отбраковки для некачественных строк, загружаемых в dim_passengers;
    *  dim_aircrafts - справочник самолетов;
    *  reject_dim_aircrafts - таблица отбраковки для некачественных строк, загружаемых в dim_aircrafts;
    *  dim_airports - справочник аэропортов;
    *  reject_dim_airports - таблица отбраковки для некачественных строк, загружаемых в dim_airports;
    *  dim_tariff - справочник тарифов (классов обслуживания);
    *  reject_dim_tariff - таблица отбраковки для некачественных строк, загружаемых в dim_tariff;
  *  Schema:
     *  dwh - схема для таблицы фактов и справочников.

## fw_dwh-27_1_dim_passengers.ktr

ETL-процедура для наполнения справочника пассажиров.
* Table tickets - выгружает данные из исходной таблицы tickets;
* phone and email - преобразует JSON в отдельные столбцы phone и email:
* Select values - приводит исходную таблицу к виду, готовому к загрузке в справочник;
* Проверка данных на качество. Строки, не прошедшие проверку, загружаются в таблицу отбраковки reject_dim_passengers:
  * Проверка на null - проверка на отсутствие пустых значений, полноту данных;
  * Проверка phone - проверка на валидность, в частности, значения в phone должны начинаться с + и иметь длину 12 символов;
  * Проверка passenger_id - проверка на уникальность значений в passenger_id;
* Table dim_passengers - загрузка проверенных исходных данных в таблицу dim_passengers.
